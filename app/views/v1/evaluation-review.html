{% extends 'layout.html' %}

{% set pageName = "Compass - Share your evaluation" %}
{% set serviceHeader = "Compass" %}

{% block beforeContent %}
  {{ breadcrumb({
    items: [
      {
        text: "Home",
        href: "/"
      },
      {
        text: "Share evaluation",
        href: "/share-evaluation"
      }
    ],
    attributes: {
      "aria-label": "Breadcrumb"
    }
  }) }}
{% endblock %}

{% block content %}
<div class="nhsuk-grid-row">
  <div class="nhsuk-grid-column-two-thirds">

    <h1 class="nhsuk-heading-xl">Evaluation details</h1>
    
    <p class="nhsuk-body">Tell us about your evaluation of <strong>SmartPump Infusion Device Pro</strong></p>

    <form action="/evaluation-upload" method="post">

      <!-- About the evaluation section -->
      <h2 class="nhsuk-heading-l nhsuk-u-margin-top-7">About the evaluation</h2>

      {{ input({
        label: {
          text: "Your trust",
          classes: "nhsuk-label--s"
        },
        id: "trust-name",
        name: "trust-name",
        value: "Mid England NHS Foundation Trust",
        attributes: {
          readonly: "readonly"
        },
        hint: {
          text: "This is automatically filled from your account"
        }
      }) }}

      {{ select({
        id: "evaluation-type",
        name: "evaluation-type",
        label: {
          text: "Evaluation type",
          classes: "nhsuk-label--s"
        },
        hint: {
          text: "Select the type of evaluation you conducted"
        },
        items: [
          {
            value: "",
            text: "Select type",
            selected: true
          },
          {
            value: "in-service",
            text: "In-service evaluation"
          },
          {
            value: "clinical-trial",
            text: "Clinical trial"
          },
          {
            value: "user-feedback",
            text: "User feedback study"
          },
          {
            value: "value-assessment",
            text: "Value assessment"
          },
          {
            value: "other",
            text: "Other"
          }
        ]
      }) }}

      <div class="nhsuk-form-group">
        <fieldset class="nhsuk-fieldset">
          <legend class="nhsuk-fieldset__legend nhsuk-label--s">
            When was this evaluation conducted?
          </legend>
          <div class="nhsuk-hint" id="date-hint">
            Select the start and end dates of your evaluation
          </div>
          <div class="nhsuk-date-input" id="evaluation-date">
            <div class="nhsuk-date-input__item">
              <div class="nhsuk-form-group">
                <label class="nhsuk-label nhsuk-date-input__label" for="start-month">
                  Start month
                </label>
                <select class="nhsuk-select nhsuk-date-input__input nhsuk-input--width-5" id="start-month" name="start-month">
                  <option value="">Month</option>
                  <option value="01">January</option>
                  <option value="02">February</option>
                  <option value="03">March</option>
                  <option value="04">April</option>
                  <option value="05">May</option>
                  <option value="06">June</option>
                  <option value="07">July</option>
                  <option value="08">August</option>
                  <option value="09">September</option>
                  <option value="10">October</option>
                  <option value="11">November</option>
                  <option value="12">December</option>
                </select>
              </div>
            </div>
            <div class="nhsuk-date-input__item">
              <div class="nhsuk-form-group">
                <label class="nhsuk-label nhsuk-date-input__label" for="start-year">
                  Start year
                </label>
                <select class="nhsuk-select nhsuk-date-input__input nhsuk-input--width-5" id="start-year" name="start-year">
                  <option value="">Year</option>
                  <option value="2025">2025</option>
                  <option value="2024">2024</option>
                  <option value="2023">2023</option>
                  <option value="2022">2022</option>
                  <option value="2021">2021</option>
                </select>
              </div>
            </div>
          </div>
          <div class="nhsuk-date-input nhsuk-u-margin-top-4" id="evaluation-date-end">
            <div class="nhsuk-date-input__item">
              <div class="nhsuk-form-group">
                <label class="nhsuk-label nhsuk-date-input__label" for="end-month">
                  End month
                </label>
                <select class="nhsuk-select nhsuk-date-input__input nhsuk-input--width-5" id="end-month" name="end-month">
                  <option value="">Month</option>
                  <option value="01">January</option>
                  <option value="02">February</option>
                  <option value="03">March</option>
                  <option value="04">April</option>
                  <option value="05">May</option>
                  <option value="06">June</option>
                  <option value="07">July</option>
                  <option value="08">August</option>
                  <option value="09">September</option>
                  <option value="10">October</option>
                  <option value="11">November</option>
                  <option value="12">December</option>
                </select>
              </div>
            </div>
            <div class="nhsuk-date-input__item">
              <div class="nhsuk-form-group">
                <label class="nhsuk-label nhsuk-date-input__label" for="end-year">
                  End year
                </label>
                <select class="nhsuk-select nhsuk-date-input__input nhsuk-input--width-5" id="end-year" name="end-year">
                  <option value="">Year</option>
                  <option value="2025">2025</option>
                  <option value="2024">2024</option>
                  <option value="2023">2023</option>
                  <option value="2022">2022</option>
                  <option value="2021">2021</option>
                </select>
              </div>
            </div>
          </div>
        </fieldset>
      </div>

      {{ textarea({
        name: "scale",
        id: "scale",
        label: {
          text: "Scale of evaluation",
          classes: "nhsuk-label--s"
        },
        hint: {
          text: "How many units tested or patients involved?"
        },
        rows: "2",
        attributes: {
          placeholder: "e.g., 5 devices over 6 months, 200 patients"
        }
      }) }}

      <!-- Clinical context section -->
      <h2 class="nhsuk-heading-l nhsuk-u-margin-top-7">Clinical context</h2>

      {{ checkboxes({
        idPrefix: "departments",
        name: "departments",
        fieldset: {
          legend: {
            text: "Department(s) involved",
            classes: "nhsuk-fieldset__legend--s"
          }
        },
        hint: {
          text: "Select all departments that participated in the evaluation"
        },
        items: [
          {
            value: "cardiology",
            text: "Cardiology"
          },
          {
            value: "emergency",
            text: "Emergency Department"
          },
          {
            value: "surgery",
            text: "Surgery"
          },
          {
            value: "renal",
            text: "Renal"
          },
          {
            value: "paediatrics",
            text: "Paediatrics"
          },
          {
            value: "intensive-care",
            text: "Intensive Care"
          },
          {
            value: "other",
            text: "Other",
            conditional: {
              html: input({
                id: "department-other",
                name: "department-other",
                label: {
                  text: "Please specify"
                }
              })
            }
          }
        ]
      }) }}

      <div class="nhsuk-form-group nhsuk-u-margin-top-6">
        <fieldset class="nhsuk-fieldset">
          <legend class="nhsuk-fieldset__legend nhsuk-fieldset__legend--s">
            Lead clinical champion
          </legend>
          <div class="nhsuk-hint">
            This will be visible to other trusts for follow-up questions
          </div>

          {{ input({
            label: {
              text: "Name"
            },
            id: "champion-name",
            name: "champion-name"
          }) }}

          {{ input({
            label: {
              text: "Role"
            },
            id: "champion-role",
            name: "champion-role",
            attributes: {
              placeholder: "e.g., Consultant Cardiologist"
            }
          }) }}

          {{ input({
            label: {
              text: "Email"
            },
            id: "champion-email",
            name: "champion-email",
            type: "email"
          }) }}
        </fieldset>
      </div>

      <!-- Your findings section -->
      <h2 class="nhsuk-heading-l nhsuk-u-margin-top-7">Your findings</h2>

      {{ radios({
        idPrefix: "recommendation",
        name: "recommendation",
        fieldset: {
          legend: {
            text: "Overall recommendation",
            classes: "nhsuk-fieldset__legend--s"
          }
        },
        items: [
          {
            value: "highly-recommend",
            text: "Highly recommend",
            hint: {
              text: "Clear improvement over alternatives"
            }
          },
          {
            value: "recommend",
            text: "Recommend",
            hint: {
              text: "Good option worth considering"
            }
          },
          {
            value: "conditional",
            text: "Conditional",
            hint: {
              text: "Works well in specific contexts"
            }
          },
          {
            value: "not-recommend",
            text: "Do not recommend",
            hint: {
              text: "Significant concerns identified"
            }
          }
        ]
      }) }}

      {{ checkboxes({
        idPrefix: "benefits",
        name: "benefits",
        fieldset: {
          legend: {
            text: "Key benefits identified",
            classes: "nhsuk-fieldset__legend--s"
          },
          attributes: {
            "aria-describedby": "benefits-hint"
          }
        },
        hint: {
          text: "Select all that apply"
        },
        items: [
          {
            value: "patient-outcomes",
            text: "Improved patient outcomes"
          },
          {
            value: "reduced-time",
            text: "Reduced clinical time/workload"
          },
          {
            value: "safety",
            text: "Better safety profile"
          },
          {
            value: "ease-of-use",
            text: "Easier to use than alternatives"
          },
          {
            value: "cost",
            text: "Lower total cost of ownership"
          },
          {
            value: "integration",
            text: "Better integration with existing systems"
          },
          {
            value: "patient-experience",
            text: "Improved patient experience"
          },
          {
            value: "other",
            text: "Other",
            conditional: {
              html: input({
                id: "benefits-other",
                name: "benefits-other",
                label: {
                  text: "Please specify"
                }
              })
            }
          }
        ]
      }) }}

      {{ radios({
        idPrefix: "issues",
        name: "issues",
        fieldset: {
          legend: {
            text: "Were any issues or concerns identified?",
            classes: "nhsuk-fieldset__legend--s"
          }
        },
        items: [
          {
            value: "no-issues",
            text: "No significant issues"
          },
          {
            value: "minor",
            text: "Minor issues (please describe below)"
          },
          {
            value: "significant",
            text: "Significant concerns (please describe below)"
          }
        ]
      }) }}

      <div class="nhsuk-character-count" data-module="nhsuk-character-count" data-maxlength="500">
        {{ textarea({
          name: "summary",
          id: "summary",
          label: {
            text: "Summary of findings",
            classes: "nhsuk-label--s"
          },
          hint: {
            html: 'Briefly describe your evaluation findings and any key outcomes. This will help other trusts understand the context.<br><br>
            <details class="nhsuk-details">
              <summary class="nhsuk-details__summary">
                <span class="nhsuk-details__summary-text">
                  See an example
                </span>
              </summary>
              <div class="nhsuk-details__text">
                <div class="nhsuk-inset-text">
                  <p>"Evaluated 5 SmartPump devices over 6 months in cardiology and renal units. Reduced medication errors by 40% compared to previous system. Staff training took longer than expected but satisfaction scores improved significantly. Recommend for high-acuity wards."</p>
                </div>
              </div>
            </details>'
          },
          rows: "6",
          attributes: {
            "data-maxlength": "500"
          }
        }) }}
        <div id="summary-info" class="nhsuk-hint nhsuk-character-count__message">
          You can enter up to 500 characters
        </div>
      </div>

      {{ textarea({
        name: "concerns",
        id: "concerns",
        label: {
          text: "Specific concerns or limitations (optional)",
          classes: "nhsuk-label--s"
        },
        hint: {
          text: 'e.g., "Integration with our EPR system required custom work" or "Not suitable for paediatric use"'
        },
        rows: "3"
      }) }}

      <!-- Clinical outcome measures section -->
      <h2 class="nhsuk-heading-l nhsuk-u-margin-top-7">Clinical outcome measures</h2>
      <p class="nhsuk-body-s nhsuk-u-secondary-text-color">Optional but recommended</p>

      {{ textarea({
        name: "outcomes",
        id: "outcomes",
        label: {
          text: "Did you measure any specific clinical outcomes?",
          classes: "nhsuk-label--s"
        },
        hint: {
          text: 'e.g., "Reduced medication errors by 40%, Decreased adverse events from 12 to 3 over evaluation period"'
        },
        rows: "3"
      }) }}

      <div class="nhsuk-inset-text nhsuk-u-margin-top-7">
        <span class="nhsuk-u-visually-hidden">Information: </span>
        <p><strong>* Required fields</strong></p>
        <p class="nhsuk-body-s">Your evaluation will be visible to NHS procurement professionals across the country to help them make informed decisions.</p>
      </div>

      <div class="nhsuk-form-group nhsuk-u-margin-top-6">
        <button class="nhsuk-button" data-module="nhsuk-button" type="submit">
          Continue to upload documents
        </button>
        <p>
          <a href="/save-draft" class="nhsuk-link nhsuk-link--no-visited-state">Save as draft</a>
        </p>
      </div>

    </form>

  </div>
</div>
{% endblock %}